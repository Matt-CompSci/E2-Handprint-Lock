@name EGP Lock
@inputs EGP:wirelink User:entity
@outputs Fade:number
@persist Whitelist:table [HandY HandX]:number PixelData:array HandPos:vector2 Open:number

if(first())
{
    entity():createWire(entity():isWeldedTo(), "EGP", "wirelink")
    entity():createWire(entity():isWeldedTo(), "User", "User")

    
    PixelData = array(
        "11111111111111111111111111111111111111111111111111111111111111111110001111111111111111111111111111111111111111111111111111111111",
        "11111111111111111111111111111111111111111111111111111111111111111100000011111111111111111111111111111111111111111111111111111111",
        "11111111111111111111111111111111111111111111111111111111111111111100000001111111111111111111111111111111111111111111111111111111",
        "11111111111111111111111111111111111111111111111111111111111111111000000000111111111111111111111111111111111111111111111111111111",
        "11111111111111111111111111111111111111111111111111111111111111111000000000111111111111111111111111111111111111111111111111111111",
        "11111111111111111111111111111111111111111111111111111111111111111000000000111111111111111111111111111111111111111111111111111111",
        "11111111111111111111111111111111111111111111111111111111111111111000000000011111111111111111111111111111111111111111111111111111",
        "11111111111111111111111111111111111111111111111111111111111111111000000000011111111111111111111111111111111111111111111111111111",
        "11111111111111111111111111111111111111111111111111111111111111111000000000011111111111111111111111111111111111111111111111111111",
        "11111111111111111111111111111111111111111111111111111111111111110000000000011111111111111111111111111111111111111111111111111111",
        "11111111111111111111111111111111111111111111111111111111111111110000000000011111111111111111111111111111111111111111111111111111",
        "11111111111111111111111111111111111111111111111111111111111111110000000000011111111111111111111111111111111111111111111111111111",
        "11111111111111111111111111111111111111000111111111111111111111110000000000011111111111111111111111000011111111111111111111111111",
        "11111111111111111111111111111111111000000001111111111111111111110000000000111111111111111111111110000001111111111111111111111111",
        "11111111111111111111111111111111110000000000111111111111111111110000000000111111111111111111111100000000111111111111111111111111",
        "11111111111111111111111111111111100000000000111111111111111111110000000000111111111111111111111000000000111111111111111111111111",
        "11111111111111111111111111111111100000000000011111111111111111110000000000111111111111111111111000000000111111111111111111111111",
        "11111111111111111111111111111111100000000000011111111111111111110000000000111111111111111111111000000000111111111111111111111111",
        "11111111111111111111111111111111100000000000011111111111111111110000000000111111111111111111110000000000111111111111111111111111",
        "11111111111111111111111111111111100000000000001111111111111111110000000000111111111111111111110000000000111111111111111111111111",
        "11111111111111111111111111111111100000000000001111111111111111110000000000111111111111111111110000000001111111111111111111111111",
        "11111111111111111111111111111111100000000000001111111111111111110000000000111111111111111111100000000001111111111111111111111111",
        "11111111111111111111111111111111100000000000001111111111111111110000000000111111111111111111100000000001111111111111111111111111",
        "11111111111111111111111111111111100000000000001111111111111111110000000001111111111111111111100000000001111111111111111111111111",
        "11111111111111111111111111111111110000000000001111111111111111110000000001111111111111111111000000000001111111111111111111111111",
        "11111111111111111111111111111111110000000000001111111111111111110000000001111111111111111111000000000011111111111111111111111111",
        "11111111111111111111111111111111110000000000001111111111111111110000000001111111111111111111000000000011111111111111111111111111",
        "11111111111111111111111111111111111000000000001111111111111111110000000001111111111111111111000000000011111111111111111111111111",
        "11111111111111111111111111111111111000000000001111111111111111110000000001111111111111111110000000000011111111111111111111111111",
        "11111111111111111111111111111111111000000000001111111111111111110000000001111111111111111110000000000111111111111111111111111111",
        "11111111111111111111111111111111111100000000001111111111111111110000000001111111111111111110000000000111111111111111111111111111",
        "11111111111111111111111111111111111100000000001111111111111111110000000001111111111111111110000000001111111111111111111111111111",
        "11111111111111111111111111111111111100000000001111111111111111110000000011111111111111111100000000001111111111111111111111111111",
        "11111111111111111111111111111111111110000000001111111111111111110000000011111111111111111100000000011111111111111111111111111111",
        "11111111111111111111111111111111111110000000001111111111111111110000000011111111111111111100000000011111111111111111111111111111",
        "11111111111111111111111111111111111110000000001111111111111111110000000011111111111111111100000000011111111111111111111111111111",
        "11111111111111111111111111111111111110000000001111111111111111110000000011111111111111111100000000111111111111111111111111111111",
        "11111111111111111111111111111111111111000000000111111111111111110000000011111111111111111000000000111111111111111111111111111111",
        "11111111111111111111111111111111111111000000000111111111111111110000000011111111111111111000000001111111111111111111111111111111",
        "11111111111111111111111111111111111111000000000111111111111111110000000011111111111111111000000001111111111111111111111111111111",
        "11111111111111111111111111111111111111000000000111111111111111110000000001111111111111111000000011111111111111111111111111111111",
        "11111111111111111111111111111111111111100000000011111111111111110000000001111111111111111000000011111111111111111111111111111111",
        "11111111111111111111111111111111111111110000000011111111111111100000000001111111111111110000000111111111111111111111111111111111",
        "11111111111111111111111111111111111111111000000001111111111111100000000011111111111111110000000111111111111111111111111111111111",
        "11111111111111111111111111111111111111111000000001111111111111110000000011111111111111110000000111111111111111111111111111111111",
        "11111111111111111111111111111111111111111000000000111111111111110000000011111111111111110000001111111111111111111111111111111111",
        "11111111111111111111111111111111111111111000000000111111111111110000000111111111111111110000001111111111111111111111111111111111",
        "11111111111111111111111111111111111111110000000000011111111111110000000111111111111111100000001111111111111111111111111111111111",
        "11111111111111111111111111111111111111110000000000011111111111110000000111111111111111000000011111111111111111111111111111111111",
        "11111111111111111111111111111111111111110000000000001111111111111000000111111111111111000000011111111111111111111111111111111111",
        "11111111111111111111111111111111111111110000000000001111111111111000000111111111111111000000011111111111111111111111111111111111",
        "11111111111111111111111111111111111111110000000000001111111111111100000111111111111110000000111111111111111111111111111111111111",
        "11111111111111111111111111111111111111111000000000001111111111111101000111111111111110000000111111111111111111111111111111111111",
        "11111111111111111111111111111111111111111000000000001111111111111111110111111111111110000001111111111111111111111111111111111111",
        "11111111111111111111111111111111111111111000000000001111111111111111111111111111111110000011111111111111111111111111111111111111",
        "11111111111111111111111111111111111111111100000000001111111111111111111111111111111111000011111111111111111111111111111000000111",
        "11111111111111111111111111111111111111111110000000000111111111111111111111111111111111100111111111111111111111111111110000000111",
        "11111111111111111111111111111111111111111110000000000011111111111111111111111111111111101111111111111111111111111111100000000111",
        "11111111111111111111111111111111111111111111000000000001111111110011111111111111111111111111111111111111111111111111000000000111",
        "11111111111111111111111111111111111111111110000000000011111111111111111111111111111111101111111111111111111111111111100000000111",
        "11111111111111111111111111111111111111111111000000000001111111110011111111111111111111111111111111111111111111111111000000000111",
        "11111111111111111111111111111111111111111111000000000000111111000000011111111111111111111111111111111111111111111100000000000111",
        "11111111111111111111111111111111111111111111000000000000000000000000001111111111111111111111111111111111111111111000000000001111",
        "11111111111111111111111111111111111111111111000000000000000000000000000111111111111111111111111111111111111111100000000000011111",
        "11111111111111111111111111111111111111111111000000000000000000000000000111111111111111111111111111111111111111000000000000011111",
        "11111111111111111111111111111111111111111110000000000000000000000000000111111111111111111111111111111111111100000000000000111111",
        "11111111111111111111111111111111111111111110000000000000000000000000000111111111111111111111111111111111111000000000000001111111",
        "11111111111111111111111111111111111111111110000000000000000000000000000111111111111111111111111111111111100000000000000011111111",
        "11111111111111111111111111111111111111111110000000000000000000000000000111111111100111111111111111111111100000000000000111111111",
        "11111111111111111111111111111111111111111110000000000000000000000000000111111111000111111111111111111111000000000000001111111111",
        "11111111111111111111111111111111111111111110000000000000000000000000000111111100000111111111111111111111000000000000111111111111",
        "11111111111111111111111111111111111111111110000000000000000000000000000111111000000111111111111111111110000000000001111111111111",
        "11111111111111111111111111111111111111111110000000000000000000000000000111110000000111111111111111111110000000000011111111111111",
        "11111111111111111111111111111111111111111110000000000000000000000000001111100000000000111111111111111110000000000111111111111111",
        "11111111111111111111111111111111111111111111000000000000000000000000000111100000000000001111111111111111000000000111111111111111",
        "11111111111111111111111111111111111111111111000000000000000000000000000010000000000000000111111111111111100000001111111111111111",
        "11111111111111111111111111111111111111111111100000000000000000000000000000000000000000000000011111111111110000011111111111111111",
        "11111111111111111111111111111111111111111111100000000000000000000000000000000000000000000000000011111111110000111111111111111111",
        "11110000000111111111111111111111111111111111110000000000000000000000000000000000000000000000000001111111111111111111111111111111",
        "11100000000011111111111111111111111111111111110000000000000000000000000000111100000000000000000000111111111111111111111111111111",
        "11100000000001111111111111111111111111111111111000000000000000000000000011111100000000000000000000011111111111111111111111111111",
        "11100000000000111111111111111111111111111111111000000000000000000000001111111110000000000000000000011111111111111111111111111111",
        "11100000000000011111111111111111111111111111111000000000000000000000001111111111000000000000000000001111111111111111111111111111",
        "11100000000000001111111111111111111111111111111100000000000000000000001111111111000000000000000000001111111111111111111111111111",
        "11100000000000000111111111111111111111111111111100000000000000000000001111111111100000000000000000001111111111111111111111111111",
        "11100000000000000011111111111111111111111111111100000000000000000000001111111111100000000000000000001111111111111111111111111111",
        "11110000000000000001111111111111111111111111111100000000000000000000001111111111100000000000000000001111111111111111111111111111",
        "11110000000000000001111111111111111111111111111000000000000000111100001111111111100000000000000000011111111111111111111111111111",
        "11111000000000000000111111111111111111111111000000000000000011111111001111111111100000000000000000011111111111111111111111111111",
        "11111100000000000000111111111111111111111110000000000000000111111111111111111111100000000000000000111111111111111111111111111111",
        "11111110000000000000011111111111111111111100000000000000000111111111111111111111100000000000000001111111111111111111111111111111",
        "11111111000000000000001111111111111111111100000000000000001111111111111111111111000000000000000001111111111111111111111111111111",
        "11111111100000000000000111111111111111111000000000000000001111111111111111111111000000000000000011111111111111111111111111111111",
        "11111111110000000000000011111111111111111000000000000000001111111111111111111111000000000000000011111111111111111111111111111111",
        "11111111111100000000000001111111111111111000000000000000001111111111111111111110000000000000000111111111111111111111111111111111",
        "11111111111111000000000000111111111111100000000000000000001111111111111111111000000000000000000111111111111111111111111111111111",
        "11111111111111110000000000001111111111000000000000000000001111111111111111000000000000000000001111111111111111111111111111111111",
        "11111111111111111100000000000111111110000000000000000000001111111111111110000000000000000000001111111111111111111111111111111111",
        "11111111111111111111111000000001111100000000000000000000001111111111111110000000000000000000011111111111111111111111111111111111",
        "11111111111111111111111100000000111000000000000000000000001111111111111110000000000000000000011111111111111111111111111111111111",
        "11111111111111111111111111000000010000000000000000000000001111111111111110000000000000000000111111111111111111111111111111111111",
        "11111111111111111111111111000000000000000000000000000000000111111111111110000000000000000000111111111111111111111111111111111111",
        "11111111111111111111111111100000000000000000000000000000000011111111111110000000000000000001111111111111111111111111111111111111",
        "11111111111111111111111111110000000000000000000000000000000001111111111110000000000000000001111111111111111111111111111111111111",
        "11111111111111111111111111110000000000000000000000000000000000111111111100000000000000000001111111111111111111111111111111111111",
        "11111111111111111111111111111000000000000000000000000000000000011111111000000000000000000001111111111111111111111111111111111111",
        "11111111111111111111111111111000000000000000000000000000000000000111110000000000000000000001111111111111111111111111111111111111",
        "11111111111111111111111111111000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111",
        "11111111111111111111111111111100000000000000000000000000000000000000000000000000000000000011111111111111111111111111111111111111",
        "11111111111111111111111111111110000000000000000000000000000000000000000000000000000000000011111111111111111111111111111111111111",
        "11111111111111111111111111111110000000000000000000000000000000000000000000000000000000000011111111111111111111111111111111111111",
        "11111111111111111111111111111111000000000000000000000000000000000000000000000000000000000011111111111111111111111111111111111111",
        "11111111111111111111111111111111100000000000000000000000000000000000000000000000000000000011111111111111111111111111111111111111",
        "11111111111111111111111111111111110000000000000000000000000000000000000000000000000000000011111111111111111111111111111111111111",
        "11111111111111111111111111111111111000000000000000000000000000000000000000000000000000000011111111111111111111111111111111111111",
        "11111111111111111111111111111111111100000000000000000000000000000000000000000000000000000111111111111111111111111111111111111111",
        "11111111111111111111111111111111111111000000000000000000000000000000000000000000000000000111111111111111111111111111111111111111",
        "11111111111111111111111111111111111111111000000000000000000000000000000000000000000000000111111111111111111111111111111111111111",
        "11111111111111111111111111111111111111111100000000000000000000000000000000000000000000000111111111111111111111111111111111111111",
        "11111111111111111111111111111111111111111111000000000000000000000000000000000000000000001111111111111111111111111111111111111111",
        "11111111111111111111111111111111111111111111100000000000000000000000000000000000000000001111111111111111111111111111111111111111",
        "11111111111111111111111111111111111111111111111000000000000000000000000000000000000000001111111111111111111111111111111111111111",
        "11111111111111111111111111111111111111111111111110000000000000000000000000000000000000011111111111111111111111111111111111111111",
        "11111111111111111111111111111111111111111111111111110000000000000000000000000000000000011111111111111111111111111111111111111111",
        "11111111111111111111111111111111111111111111111111111111000000000000000000000000000000111111111111111111111111111111111111111111",
        "11111111111111111111111111111111111111111111111111111111111110000000000000000000000001111111111111111111111111111111111111111111",
        "11111111111111111111111111111111111111111111111111111111111111111100000000000000000011111111111111111111111111111111111111111111",
        "11111111111111111111111111111111111111111111111111111111111111111111110000000000000111111111111111111111111111111111111111111111",
        "11111111111111111111111111111111111111111111111111111111111111111111111111000000011111111111111111111111111111111111111111111111"
    )

    
    function void drawBase()
    {
        EGP:egpClear()
        
        EGP:egpBox(1, vec2(256), vec2(512))
        EGP:egpMaterial(1, "gui/center_gradient")
        EGP:egpColor(1, vec(126, 0, 46))
        
        Size = 128
        Color = 1
        
        EGP:egpBox(2, vec2(256, 75), vec2(384, 64))
        EGP:egpColor(2, vec(0))
        EGP:egpAlpha(2, 150)
        
        EGP:egpText(3, "Security", vec2(256, 75))
        EGP:egpAlign(3, 1, 1)
        EGP:egpSize(3, 42)
        
        for(I = 4, 4)
        {
            Color += 0.1
            Size -= 10
            EGP:egpCircle(I, vec2(256), vec2(Size))
            EGP:egpColor(I, vec(50) * Color)
            EGP:egpAlpha(I, 0.8 * Size)
        }
        
        EGP:egpCircle(5, vec2(256), vec2(96))
        EGP:egpColor(5, vec(255, 0, 0))
        EGP:egpAlpha(5, 125)
        
        
        EGP:egpText(6, "Press E", vec2(256))
        EGP:egpAlign(6, 1, 1)
        EGP:egpSize(6, 42)
    }
        
    function void egpHandPrint(Pos:vector2)
    {
        HandPos = Pos
        NumObjs = EGP:egpNumObjects() + 1
        

        foreach(K, V:string = PixelData)
        {
            if(K % 5 == 1)
            {
                for(I = 1, V:length(), 5)
                {
                    if(perf(90))
                    {
                        if(V[I] == "0")
                        {
                            NumObjs++
                            EGP:egpBox(NumObjs,Pos + vec2(I, K), vec2(1))
                        }
                    }
                    
                    else
                    {
                        HandY = K
                        HandX = I
                        timer("FinishHandDrawing", 100)
                        return
                    }
                }
            }
        }
    }
    
    drawBase()
    Whitelist[owner():steamID(), string] = owner():steamID()
    runOnChat(1)
    
    function void prettyPrint(Message:string)
    {
        printColor(vec(255, 0, 0), "[" + entity():getName() + "] : ", vec(255), Message)
    }
    
    prettyPrint("Automatically added yourself to the whitelist!")
}

elseif(clk("FinishHandDrawing"))
{
    NumObjs = EGP:egpNumObjects()
    Escaped = 0
    for(K = HandY, PixelData:count())
    {
        if(K % 5 == 1)
        {
            for(I = 1, PixelData[K, string]:length(), 5)
            {
                if(perf(90))
                {
                    if(PixelData[K, string][I] == "0")
                    {
                        NumObjs++
                        EGP:egpBox(NumObjs, HandPos + vec2(I, K), vec2(1))
                    }
                }
                
                else
                {
                    HandY = K
                    HandX = I
                    timer("FinishHandDrawing", 100)
                    Escaped = 1
                    break
                }
            }
        }
        
        if(Escaped)
        {
            break
        }
        
    }
}

elseif(chatClk(owner()))
{
    LS = owner():lastSaid():explode(" ")
    
    if(LS[1, string]:lower() == "!add")
    {
        LS:remove(1)
        Name = LS:concat(" ")
        Ply = findPlayerByName(Name)
        if(Whitelist:exists(Ply:steamID()))
        {
            prettyPrint("Player is already in the whitelist!")
        }
        Whitelist[Ply:steamID(), string] = Ply:steamID()
        prettyPrint("Added " + Ply:name() + " to the whitelist!")
    }
    
    elseif(LS[1, string]:lower() == "!remove")
    {
        LS:remove(1)
        Name = LS:concat(" ")
        Ply = findPlayerByName(Name)
        
        if(Whitelist:exists(Ply:steamID()))
        {
            Whitelist:remove(Ply:steamID())
            prettyPrint("Removed " + Ply:name() + " from the whitelist")
        }
        
        else
        {
            prettyPrint("You can't remove a player who isn't in the whitelist!")
        }
    }
}

elseif(clk("Reset"))
{
    EGP:egpClear()
    drawBase()
    Fade = 0
    Open = 0
}

elseif(inputClkName() == "User")
{
    if(!Open)
    {
        Open = 1
        egpHandPrint(vec2(192))
        NumObj = EGP:egpNumObjects() + 1
        
        if(User:keyUse())
        {
            EGP:egpAlpha(5, 150)
            EGP:egpRemove(6)
            
            if(Whitelist:exists(User:steamID()))
            {
                Fade = 1
                
                EGP:egpBox(299, vec2(256, 440), vec2(256, 64))
                EGP:egpColor(299, vec(0))
                EGP:egpAlpha(299, 125)
                
                EGP:egpText(300, "Access Granted", vec2(256, 440))
                EGP:egpAlign(300, 1, 1)
                EGP:egpColor(300, vec(0, 255, 0))
                EGP:egpSize(300, 32)
            }
            
            else
            {
                EGP:egpBox(299, vec2(256, 440), vec2(256, 64))
                EGP:egpColor(299, vec(0))
                EGP:egpAlpha(299, 125)
                
                EGP:egpText(300, "Access Denied", vec2(256, 440))
                EGP:egpAlign(300, 1, 1)
                EGP:egpColor(300, vec(255, 0, 0))
                EGP:egpSize(300, 32)
                
                Fade = 0
    
            }
            
            timer("Reset", 5000)
        }
    }
}
